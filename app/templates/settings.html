{% extends "base.html" %}

{% block title %}Settings - SSH Key Manager{% endblock %}

{% block content %}
<h1>System Settings</h1>

{% if success %}
    <div class="alert-success">✅ Settings saved successfully!</div>
{% endif %}

<form method="post" action="/admin/settings">

    <!-- General Settings Block -->
    <div class="settings-block">
        <h2>General Settings</h2>

        <label>Domain:</label><br>
        <input type="text" name="domain" value="{{ settings.domain }}" class="input-standard"><br><br>
    </div>

    <!-- Security Settings Block -->
    <div class="settings-block">
        <h2>Security Settings</h2>

        <div class="security-password-section">
            <label>
                <input type="checkbox" name="enforce_password_complexity" 
                {% if settings.enforce_password_complexity == '1' %}checked{% endif %}>
                Enforce Password Complexity
            </label><br><br>
            <div class="password-policy">
              <h3>Password Requirements:</h3>
              <ul>
                <li>Minimum <strong>14 characters</strong> in length</li>
                <li>At least <strong>one number</strong> (0–9)</li>
                <li>At least <strong>one special character</strong> (e.g., ! @ # $ % ^ & *)</li>
                <li>Must <strong>not contain</strong> your username</li>
                <li>Must <strong>not contain common weak words</strong>: admin, password, qwerty, letmein, 123456, welcome</li>
              </ul>
            </div>
        </div>

        <label>
            <input type="checkbox" name="restrict_admin_ip" {% if settings.restrict_admin_ip == '1' %}checked{% endif %}>
            Restrict Admin Interface Access by IP/ASN
        </label><br><br>
        <div id="admin-ip-list"></div>
        
        <hr>
        
        <label>Admin Session Timeout (minutes):</label><br>
        <input type="number" name="admin_session_timeout" value="{{ settings.admin_session_timeout }}" 
               class="number" min="1" max="99" oninput="this.value = this.value.replace(/[^0-9]/g, '');"><br><br>
    </div>

    <!-- Email (SMTP) Settings Block -->
    <div class="settings-block">
        <h2>Email (SMTP) Settings</h2>

        <label>SMTP Host:</label><br>
        <input type="text" name="smtp_host" value="{{ settings.smtp_host }}" class="input-standard"><br><br>

        <label>SMTP Port:</label><br>
        <input type="text" name="smtp_port" value="{{ settings.smtp_port }}" class="input-standard"><br><br>

        <label>SMTP Username:</label><br>
        <input type="text" name="smtp_user" value="{{ settings.smtp_user }}" class="input-standard"><br><br>

        <label>SMTP Password (Leave empty if unchanged):</label><br>
        <input type="password" name="smtp_password" class="input-standard"><br><br>

        <label>From Email Address:</label><br>
        <input type="email" name="smtp_from" value="{{ settings.smtp_from }}" class="input-standard"><br><br>
    </div>

    <button type="submit">Save Settings</button>

</form>

<br>
<a href="/admin/dashboard">← Back to Dashboard</a>
{% endblock %}