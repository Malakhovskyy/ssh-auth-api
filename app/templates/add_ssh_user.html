{% extends "base.html" %}

{% block title %}Add SSH User - SSH Key Manager{% endblock %}

{% block content %}
<h1>Add SSH User</h1>

{% if error %}
    <div class="error">{{ error }}</div>
{% endif %}

<form method="post" action="/admin/ssh-users/add">

    <label>Username:</label><br>
    <input type="text" name="username" class="input-standard" required value="{{ prefill_username if prefill_username else '' }}"><br><br>

    <label>Email:</label><br>
    <input type="email" name="email" class="input-standard" required value="{{ prefill_email if prefill_email else '' }}"><br><br>

    <label>Expiration Date:</label><br>
    <input type="text" id="expiration_date" name="expiration_date" class="input-standard" required><br><br>

    <label>
        <input type="checkbox" id="never_expires" name="never_expires" checked>
        Never Expires
    </label><br><br>

    <label>
        <input type="checkbox" name="locked"
        {% if prefill_locked %}checked{% endif %}>
        Locked
    </label><br><br>

    <button type="submit">Create SSH User</button>
</form>

<script src="/static/js/flatpickr.min.js"></script>
<link rel="stylesheet" href="/static/css/flatpickr.min.css">

<script>
// Flatpickr calendar + clock
flatpickr("#expiration_date", {
    enableTime: true,
    dateFormat: "Y-m-d H:i:S",
});

const expirationInput = document.getElementById('expiration_date');
const neverExpiresCheckbox = document.getElementById('never_expires');

// Function to update expiration field state
function updateExpirationField() {
    if (neverExpiresCheckbox.checked) {
        expirationInput.value = "2099-12-31 23:59:59";
        expirationInput.disabled = true;
        expirationInput.style.backgroundColor = "#f0f0f0"; // grey background
    } else {
        const today = new Date();
        const nextYear = new Date(today.setFullYear(today.getFullYear() + 1));
        expirationInput.disabled = false;
        expirationInput.style.backgroundColor = "white"; // normal background
        expirationInput.value = nextYear.toISOString().slice(0, 19).replace('T', ' ');
    }
}

// Run on page load
updateExpirationField();

// Update when checkbox changes
neverExpiresCheckbox.addEventListener('change', updateExpirationField);
</script>

<br><a href="/admin/ssh-users">‚Üê Back to SSH Users List</a>

{% endblock %}
